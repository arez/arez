---
title: Dependency Injection
---

Arez components provide several different mechanisms for integrating into dependency injection
frameworks. The two dependency injection frameworks that have seen the most use are
[Dagger2](https://google.github.io/dagger) and [Gin](https://code.google.com/archive/p/google-gin/).
This is due to Arez being primarily used within a web browser context.

Arez components typically consist of the base component (i.e. `com.example.MyComponent`), the enhanced
component class generated by the Arez annotation processor (i.e. `com.example.Arez_MyComponent`)
and an optionally generated repository class (i.e. `com.example.MyComponentRepository`) and an enhanced
repository class (i.e. `com.example.Arez_MyComponentRepository`). All of the classes but the base component
are generated by the annotation processor.

Arez mandates that dependencies are passed in to the constructor. Historically, Arez also supported injection
of dependencies into fields and methods but this resulted in increased code-size when compiled to javascript
and more complex code being generated. As a result constructor injection is now mandated.

Typically when using Arez component in an application that uses dependency injection, the consuming
code will receive a reference to the base component (i.e. `com.example.MyComponent`) or the base repository
(i.e. `com.example.MyComponentRepository`) as a constructor parameter. The consumer code ends up looking
something like the following example:

{@file_content: file=arez/doc/examples/inject2/ExampleConsumer.java "start_line=public class"}

The `ExampleConsumer` class needs to be injected with two separate dependencies; `MyService`
and `MyEntityRepository`. Every injection framework uses a slightly different mechanism to determine how to
construct and wire together a graph of objects however a common strategy is to add an `@Inject` annotation to
a single constructor for the type to be injected. Within the context of Arez this means annotating a constructor
in the enhanced classes (i.e. `com.example.Arez_MyComponent` and `com.example.Arez_MyComponentRepository`).

Arez will add the `@Inject` annotation to the constructor of the enhanced component if the `inject` parameter
on the `@ArezComponent` is set to `ENABLE`. If the `inject` parameter is `AUTODETECT` and the base component is
annotated with a "scope" annotation then Arez will annotate the enhanced subclass with the same scope annotation
and add an `@Inject` annotation to the constructor.

The {@api_url: annotations.Repository} annotation has a similar `inject` parameter and the base repository will
be automatically annotated with the `@javax.inject.Singleton` scope annotation if the `javax.inject.Inject` class
is present.

This would be sufficient if the consumer code always consumed the enhanced classes but as this is rarely the
case, each injection framework has mechanisms that allow the framework to supply an instance of the enhanced
sub-class when the base class is requested. The way this is done is framework specific and Dagger integration
is covered in the following section.

## Dagger2

[Dagger2](https://google.github.io/dagger) is a modern take on a dependency injection framework that uses annotation
processors and statically checks the object graph at compilation time. The root objects in the graph are accessed via
a component which is an interface annotated by the `@dagger.Component` annotation. The injection rules are customized
via `@dagger.Module` annotated classes.

The {@api_url: annotations.ArezComponent} and {@api_url: annotations.Repository} annotations have a `dagger`
parameter that controls whether the Arez annotation processor generates dagger modules. If the value of the
`dagger` parameter is `ENABLE` or `AUTODETECT` and the `dagger.Component` class is on the classpath then a
module will be generated for each base component and base repository that looks like:

{@file_content: path=generated/processors/main/java file=arez/doc/examples/inject2/MyServiceDaggerModule.java "start_line=@Generated"}

These can be incorporated into a dagger component like:

{@file_content: file=arez/doc/examples/inject2/ExampleDaggerComponent.java "start_line=@Singleton"}

And used in code like:

{@file_content: file=arez/doc/examples/inject2/DaggerExample.java "start_line=  {" "end_line=  }" include_start_line=false include_end_line=false strip_block=true}
